\chapter{Client Task\+: Auth\+Proxy Communication Adapters }
\hypertarget{md_doc_2_task}{}\label{md_doc_2_task}\index{Client Task: AuthProxy Communication Adapters@{Client Task: AuthProxy Communication Adapters}}
\label{md_doc_2_task_autotoc_md54}%
\Hypertarget{md_doc_2_task_autotoc_md54}%
\hypertarget{md_doc_2_task_autotoc_md55}{}\doxysection{\texorpdfstring{Feature Request\+: Implement HTTP and Web\+Socket Adapters}{Feature Request\+: Implement HTTP and Web\+Socket Adapters}}\label{md_doc_2_task_autotoc_md55}
{\bfseries{Goal\+:}} Create C++ adapters within the client application to handle communication with the {\ttfamily authproxy} microservice for user authentication and lobby management, and to establish a Web\+Socket connection for real-\/time features with the {\ttfamily calculation\+\_\+unit}.

{\bfseries{Components\+:}}
\begin{DoxyEnumerate}
\item {\bfseries{HTTP Adapter\+:}} Handles RESTful API calls to {\ttfamily authproxy} using the {\bfseries{Crow C++ library}}.
\item {\bfseries{Web\+Socket Adapter\+:}} Handles establishing and managing a Web\+Socket connection to the {\ttfamily calculation\+\_\+unit} after authentication via {\ttfamily authproxy}.
\end{DoxyEnumerate}

\DoxyHorRuler{0}
\hypertarget{md_doc_2_task_autotoc_md57}{}\doxysection{\texorpdfstring{HTTP Adapter ({\ttfamily http-\/adapter.\+cpp}) Tasks}{HTTP Adapter ({\ttfamily http-\/adapter.\+cpp}) Tasks}}\label{md_doc_2_task_autotoc_md57}
Implement functions within {\ttfamily http-\/adapter.\+cpp} using the {\bfseries{Crow C++ library}} (\href{https://crowcpp.org/}{\texttt{https\+://crowcpp.\+org/}}) to support the following {\ttfamily authproxy} endpoints. {\bfseries{All HTTP communication (request bodies and expected response bodies) MUST use the JSON format.}}


\begin{DoxyEnumerate}
\item {\bfseries{Create User\+:}}
\begin{DoxyItemize}
\item {\bfseries{Method\+:}} {\ttfamily POST}
\item {\bfseries{Path\+:}} {\ttfamily /authproxy/user}
\item {\bfseries{Request Headers\+:}}
\begin{DoxyItemize}
\item {\ttfamily Authorization}\+: Bearer {\ttfamily \texorpdfstring{$<$}{<}token\texorpdfstring{$>$}{>}} (Obtained from Authenticate User step)
\end{DoxyItemize}
\item {\bfseries{Request Body (JSON)\+:}} {\ttfamily json \{ "{}username"{}\+: "{}example\+\_\+user"{}, "{}password"{}\+: "{}example\+\_\+password"{} \} }
\item {\bfseries{Response (JSON)\+:}} Expected\+: {\ttfamily \{"{}message"{}\+: "{}\+Successfully created user!"{}\}} on success (Status 200). (Need clarification from PL on error response structure/status).
\end{DoxyItemize}
\item {\bfseries{Authenticate User\+:}}
\begin{DoxyItemize}
\item {\bfseries{Method\+:}} {\ttfamily GET}
\item {\bfseries{Path\+:}} {\ttfamily /authproxy/authenticate}
\item {\bfseries{Request Headers\+:}}
\begin{DoxyItemize}
\item {\ttfamily Authorization}\+: Basic {\ttfamily \texorpdfstring{$<$}{<}Base64 encoded username\+:password\texorpdfstring{$>$}{>}}
\end{DoxyItemize}
\item {\bfseries{Response (JSON)\+:}} Expected\+: {\ttfamily \{"{}message"{}\+: "{}\+Authentication was successful!"{}\}} (Status 200). The Bearer token is returned in the {\ttfamily Authenticate} response header. (Need clarification from PL if JSON body should also contain the token).
\end{DoxyItemize}
\item {\bfseries{Create Lobby\+:}}
\begin{DoxyItemize}
\item {\bfseries{Method\+:}} {\ttfamily POST}
\item {\bfseries{Path\+:}} {\ttfamily /authproxy/lobbys}
\item {\bfseries{Request Headers\+:}}
\begin{DoxyItemize}
\item {\ttfamily Authorization}\+: Bearer {\ttfamily \texorpdfstring{$<$}{<}token\texorpdfstring{$>$}{>}} (Obtained from Authenticate User step)
\end{DoxyItemize}
\item {\bfseries{Request Body (JSON)\+:}} {\ttfamily json \{ "{}lobby\+Name"{}\+: "{}example\+\_\+lobby"{}, // "{}password"{}\+: "{}optional\+\_\+password"{} // Omit field if no password is set \} }
\item {\bfseries{Response (JSON)\+:}} Expected\+: {\ttfamily \{"{}message"{}\+: "{}\+Successfully created Lobby! Please start Web Socket Connection with Lobby Info!"{}\}} on success (Status 200). (Need clarification from PL on error response structure/status).
\end{DoxyItemize}
\end{DoxyEnumerate}

\DoxyHorRuler{0}
\hypertarget{md_doc_2_task_autotoc_md59}{}\doxysection{\texorpdfstring{Web\+Socket Adapter ({\ttfamily websocket-\/adapter.\+cpp}) Task}{Web\+Socket Adapter ({\ttfamily websocket-\/adapter.\+cpp}) Task}}\label{md_doc_2_task_autotoc_md59}
Implement functionality within {\ttfamily websocket-\/adapter.\+cpp} (using a suitable C++ Web\+Socket library with Message\+Pack support) to\+:


\begin{DoxyEnumerate}
\item {\bfseries{Connect to Calculation Unit\+:}}
\begin{DoxyItemize}
\item {\bfseries{Target Service\+:}} {\ttfamily calculation\+\_\+unit}
\item {\bfseries{Path\+:}} {\ttfamily /msgpack} (Based on {\ttfamily calculation\+\_\+unit/src/main.\+rs})
\item {\bfseries{Headers\+:}}
\begin{DoxyItemize}
\item {\ttfamily Authorization}\+: Bearer {\ttfamily \texorpdfstring{$<$}{<}token\texorpdfstring{$>$}{>}} (Obtained from HTTP authentication step 2)
\end{DoxyItemize}
\item {\bfseries{Purpose\+:}} Establish a persistent connection after successful authentication for real-\/time communication.
\item {\bfseries{Data Format\+:}} All messages sent and received over this Web\+Socket connection {\bfseries{MUST use the Message\+Pack (msgpack) format.}}
\end{DoxyItemize}
\end{DoxyEnumerate}

\DoxyHorRuler{0}
\hypertarget{md_doc_2_task_autotoc_md61}{}\doxysection{\texorpdfstring{Connection Flow Summary}{Connection Flow Summary}}\label{md_doc_2_task_autotoc_md61}
The intended sequence of operations for the client is\+:


\begin{DoxyEnumerate}
\item {\bfseries{Register\+:}} Call {\ttfamily POST /authproxy/user} to create a new user account (Requires Bearer token -\/ {\itshape Note\+: This seems unusual, typically registration doesn\textquotesingle{}t require prior auth. Clarify with PL if this endpoint needs auth}).
\item {\bfseries{Login\+:}} Call {\ttfamily GET /authproxy/authenticate} using Basic Auth to receive a Bearer token (in the {\ttfamily Authenticate} header).
\item {\bfseries{Create Lobby\+:}} Call {\ttfamily POST /authproxy/lobbys} using the Bearer token to create a game lobby.
\item {\bfseries{Connect Web\+Socket\+:}} Establish a Web\+Socket connection to {\ttfamily calculation\+\_\+unit} at {\ttfamily /msgpack} using the Bearer token for authorization.
\end{DoxyEnumerate}

\DoxyHorRuler{0}
\hypertarget{md_doc_2_task_autotoc_md63}{}\doxysection{\texorpdfstring{Notes \& Questions for Project Leader (PL)}{Notes \& Questions for Project Leader (PL)}}\label{md_doc_2_task_autotoc_md63}

\begin{DoxyItemize}
\item {\bfseries{Crow C++ Library Integration\+:}} How should the Crow library be integrated into the client project? (e.\+g., Header-\/only include, package manager like Conan/vcpkg, submodule?).
\item {\bfseries{Data Formats\+:}} Confirmed\+: HTTP uses JSON, Web\+Socket uses Message\+Pack.
\item {\bfseries{Web\+Socket Endpoint ({\ttfamily /calculate} vs {\ttfamily /msgpack})\+:}} Confirmed\+: The Rust service ({\ttfamily calculation\+\_\+unit}) exposes {\ttfamily /msgpack} for Message\+Pack Web\+Socket connections.
\item {\bfseries{Web\+Socket Token Validation\+:}} How does {\ttfamily calculation\+\_\+unit} validate the Bearer token received in the Web\+Socket handshake? Does it call {\ttfamily authproxy}? (Codebase doesn\textquotesingle{}t show validation logic).
\item {\bfseries{Auth Header Format\+:}} Confirmed\+: {\ttfamily Authorization\+: Bearer \texorpdfstring{$<$}{<}token\texorpdfstring{$>$}{>}} is the correct format for authenticated HTTP requests and Web\+Socket connection headers (based on {\ttfamily authproxy} middleware).
\item {\bfseries{Web\+Socket Library\+:}} Is a specific C++ Web\+Socket library preferred, or should one be selected? Must support Message\+Pack and custom headers.
\item {\bfseries{Base URLs\+:}} Confirmed\+: For client development outside Docker, use {\ttfamily \href{http://localhost:8080}{\texttt{http\+://localhost\+:8080}}} for {\ttfamily authproxy} and {\ttfamily ws\+://localhost\+:8082} for {\ttfamily calculation\+\_\+unit}.
\item {\bfseries{API Responses \& Errors\+:}}
\begin{DoxyItemize}
\item What are the expected error response bodies (JSON structure) and HTTP status codes for the defined HTTP endpoints?
\item How should Web\+Socket connection errors or invalid messages (in Message\+Pack format) be handled?
\end{DoxyItemize}
\item {\bfseries{Optional Lobby Password\+:}} Confirmed\+: Omit the {\ttfamily password} field in the JSON payload for {\ttfamily POST /authproxy/lobbys} if no password is desired.
\item {\bfseries{User Creation Auth\+:}} The {\ttfamily POST /authproxy/user} endpoint currently has {\ttfamily validate\+Authorization} middleware. Does creating a user really require an existing valid Bearer token? This seems counter-\/intuitive for registration.
\end{DoxyItemize}

asynchroner call endpunkte bauen create lobby, gibt bool zur√ºck 